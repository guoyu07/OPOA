/**
 * EasyOPOA FrameWork
 * 
 * Version 2.4.1
 * 
 * http://easyproject.cn
 * https://github.com/ushelp/EasyOPOA
 * 
 * Copyright 2014 Ray [ inthinkcolor@gmail.com ]
 * 
 * Dependencies: jQuery
 * 
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var O,b=window.EasyOPOA,c=window.OPOA,d={eles:{},home:{}},e=!0,f=window.location.href.split("#")[0]+"#",g=function(b,c,d,e){var f,g;"post"==d.method.toLowerCase()&&(f=c.indexOf("?"),-1!=f&&(e=(e?e:"")+"&"+c.substring(f+1),c=c.substring(0,f))),g=z[b]||O.Configs.loading,g.start&&g.start(b,c,d,e),a.ajax({url:c+(-1!=c.indexOf("?")?"&":"?")+"&opoa_timestamp="+new Date,type:d.method,data:e,success:function(f){var j,h=a(d.show),i=f;d.find&&(i=a("<div>").html(f).find(d.find).html(),i||("function"==typeof y[b]?(y[b](),i=""):(j=O.Configs.notFound,y[b]&&(j=y[b].toLowerCase()),i="empty"==j?"":"all"==j?f:y[b]))),g.success&&g.success(b,c,d,e),h.html(i)},statusCode:A[b]||O.Configs.urlErrors,error:function(){g.error&&g.error(b,c,d,e)},complete:function(){g.end&&g.end(b,c,d,e)}})},h=function(b){var c=b.data,d=a(this).attr(c.hash),e=a(this).attr(c.url);d||a(this).attr("href")&&(d=a(this).attr("href")),e||a(this).attr("href")&&(e=a(this).attr("href")),d&&(B[d]&&(e=B[d][0]),o(d,e,c),g(d,e,c,null),c.prevent&&b.preventDefault())},i=function(b){a(b.actions).off("click",h),a(b.actions).on("click",b,h)},j=function(b){var d,e,f,g,c={};a.extend(!0,c,O.Configs,b),d=p(c),b["actionMaps"]&&a.each(b["actionMaps"],function(a,b){O.addActionMap(a,b,c)}),u(c),e=r(c),B=a.extend(e,B),f=s(c,d.urlErrors),A=a.extend(f,A),g=t(c,d.loading),z=a.extend(!0,g,z),i(c)},k=function(b,c,d){var f,g,h,i,j,e=c.exec(d);if(e){for(f=C[b][0],g=e.slice(1),a.each(g,function(a,b){g[a]=decodeURIComponent(b)}),h=new Array,b.replace(I,function(a){h.push(a.substring(1))}),i={},j=0;j<g.length;j++)i[h[j]]=g[j];return f=f.replace(K,function(a,b){return i[b]?i[b]:(b=b.replace(L,""),M.test(b)?g[parseInt(b)]:"")})}return d},l=function(){C&&a.each(C,function(b,c){var g,d=N(b),e=c[1],f={};a.extend(!0,f,O.Configs,e),g=p(f),a(f.actions).each(function(){var e,c=a(this).attr(f.hash);d.test(c)&&(A[c]=g.urlError,z[c]=g.loading,e=B[c][0],B[c][0]=k(b,d,e),B[c][1]=f)})})},m=function(b,c,d){O.cookieLast&&a.cookie&&window.JSON&&JSON.parse&&(a.cookie("hash",b),a.cookie("url",c),a.cookie("opoa",JSON.stringify(d)))},n=function(a,b,c){var d,e;window.history.pushState&&(d=f+a,e={hash:a,url:b,opoa:c},window.history.replaceState(e,document.title,d)),m(a,b,c)},o=function(a,b,c){var d,e;c.pushHash&&(window.history.pushState?(d=f+a,e={hash:a,url:b,opoa:c},window.history.pushState(e,document.title,d)):window.location.hash="#"+a,m(a,b,c))},p=function(a){var c,b=a["urlErrors"];return delete a["urlErrors"],c=a["loading"],delete a["loading"],{urlErrors:b,loading:c}},q=function(b){a.each(C,function(c,d){var g,h,i,e=N(c),f=d[1];return e.test(b)?(g={},a.extend(!0,g,O.Configs,f),h=k(c,e,b),y[b]=g.notFound,i=p(g),A[b]=i.urlError,z[b]=i.loading,B[b]=[h,g],!1):void 0})},r=function(b){var c={};return a(b.actions).each(function(){var e=a(this).attr(b.hash),f=a(this).attr(b.url);f?c[e]=[f,b]:(q(e),c[e]||(f=e,c[e]=[f,b]))}),c},s=function(b,c){var d={};return a(b.actions).each(function(){var f=a(this).attr(b.hash);d[f]=c}),d},t=function(b,c){var d={};return a(b.actions).each(function(){var f=a(this).attr(b.hash);d[f]=c}),d},u=function(b){a(b.actions).each(function(){var d=a(this).attr(b.hash);y[d]=b.notFound}),delete b.notFound},v=function(b,c){var d,e;q(b),B[b]?(d=B[b][0],e={},8!=E(B[b][1])?(a.extend(!0,e,O.Configs,B[b][1]),p(e),B[b][1]=e):e=B[b][1],n(b,d,e),g(b,d,e,c)):O.notHash(b)},w=function(){var a,b;d.home.hash?d.home.url?g(d.home.hash,d.home.url,d.home.opoa,d.home.postData):(a=d.home.hash,b=d.home.postData,v(a,b)):O.homeFun()},x=function(a,b){y[a]=b.notFound,A[a]=b.urlErrors,z[a]=b.loading,delete b.notFound,delete b.loading,delete b.urlErrors},y={},z={},A={},B={},C={},D=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},E=function(b){var c=0;return a.each(b,function(){c++}),c},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,H=/\*\w+/g,I=/(\(\?)?:\w+|\*\w+/g,J=/[\-{}\[\]+?.,\\\^$|#\s]/g,K=/\{([^}]+)\}/g,L=/\ /g,M=/^[0-9]+$/,N=function(a){return a=a.replace(J,"\\$&").replace(F,"(?:$1)?").replace(G,function(a,b){return b?a:"([^/]+)"}).replace(H,"(.*?)"),new RegExp("^"+a+"$")};return a(window).on("popstate",function(){var a,b,c;window.history.state?(a=window.history.state.url,b=window.history.state.hash,c=window.history.state.opoa,g(b,a,c,null)):w()}),O={cookieLast:!0,Configs:{actions:null,show:null,hash:"hash",url:"hash",find:null,notFound:"empty",method:"post",pushHash:!0,prevent:!0,actionMaps:{},urlErrors:{404:function(){},500:function(){}},loading:{start:function(){},success:function(){},error:function(){},end:function(){}}},notHash:function(){},addActionMap:function(b,c,d){if(D(b))a.each(b,function(b,c){var d,e,f,g;D(c)?(d={},e=c[0],f=c[1],g=c[2],a.extend(!0,d,O.Configs,g),x(e,d),-1!=c[0].indexOf(":")||-1!=e.indexOf("*")?C[e]=[f,d]:B[e]=[f,d]):a.each(c,function(b,c){var d={};d=a.extend(!0,d,O.Configs,c[1]),y[b]=d.notFound,x(b,d),-1!=b.indexOf(":")||-1!=b.indexOf("*")?C[b]=[c[0],d]:B[b]=[c[0],d]})});else{var e={};a.extend(!0,e,O.Configs,d),y[b]=e.notFound,x(b,e),-1!=b.indexOf(":")||-1!=b.indexOf("*")?C[b]=[c,e]:B[b]=[c,e]}},addActionUrlErrors:function(b,c){D(b)?a.each(b,function(a,b){A[b]=c}):A[b]=c},addActionLoadings:function(b,c){D(b)?a.each(b,function(a,b){z[b]=c}):z[b]=c},preFirstHash:function(){return!0},start:function(b,c){c&&(D(c)?O.addActionMap(c):a.each(c,function(a,b){O.addActionMap(a,b[0],b[1])})),a(function(){var c,d,f;if(b&&(D(b)?a.each(b,function(a,b){j(b)}):j(b),l()),e)if(e=!1,window.location.hash){if(c=window.location.hash.substring(1),!O.preFirstHash(c))return;v(c,null)}else O.cookieLast?a.cookie&&window.JSON&&JSON.parse?(c=a.cookie("hash"),d=a.cookie("url"),f=a.cookie("opoa"),f?(f=JSON.parse(f),d&&(n(c,d,f),q(c),g(c,d,f,null))):w()):w():w()})},home:function(a,b){d.home={hash:a,postData:b}},homeUrl:function(b,c,e){var h,f="",g={};a.extend(!0,g,O.Configs,c),y[f]=g.notFound,delete g.notFound,h=p(g),O.addActionLoadings(f,h.loading),d.home={hash:f,url:b,opoa:g,postData:e}},homeFun:function(){},load:function(b,c){a(function(){q(b),B[b]?(o(b,B[b][0],B[b][1]),g(b,B[b][0],B[b][1],c)):O.notHash&&O.notHash(b)})},loadLinked:function(b){var c,d,e,f,g,h;if(D(b)){for(c=b[0],d=c[0],e=c[1],f=0;f<b.length;f++)f<b.length-1&&(g=b[f],h=g[0],function(c,d){var e=z[d],f={};a.extend(!0,f,e),f.end=function(a){var d,f,g;e.end(a),d=b[c+1],f=d[0],g=d[1],O.load(f,g),z[a]=e},z[d]=f}(f,h));O.load(d,e)}},noConflict:function(a){return window.OPOA===O&&(window.OPOA=c),a&&window.EasyOPOA===O&&(window.EasyOPOA=b),O}},window.EasyOPOA=window.OPOA=O,O});
