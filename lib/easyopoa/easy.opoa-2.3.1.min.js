/**
 * EasyOPOA FrameWork
 * 
 * Version 2.3.1
 * 
 * http://easyproject.cn
 * https://github.com/ushelp/EasyOPOA
 * 
 * Copyright 2014 Ray [ inthinkcolor@gmail.com ]
 * 
 * Dependencies: jQuery
 * 
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var N,b=window.EasyOPOA,c=window.OPOA,d={eles:{},home:{}},e=!0,f=window.location.href.split("#")[0]+"#",g=function(b,c,e,f){var g,h;"post"==e.method.toLowerCase()&&(g=c.indexOf("?"),-1!=g&&(f=(f?f:"")+"&"+c.substring(g+1),c=c.substring(0,g))),h=y[b]||N.Configs.loading,h.start&&h.start(b,c,e,f),a.ajax({url:c+(-1!=c.indexOf("?")?"&":"?")+"&opoa_timestamp="+new Date,type:e.method,data:f,success:function(g){var k,l,i=e.show,j=d.eles[i];j||(j=a(i),d.eles[i]=j),k=g,e.find&&(k=a("<div>").html(g).find(e.find).html(),k||("function"==typeof x[b]?(x[b](),k=""):(l=N.Configs.notFound,x[b]&&(l=x[b].toLowerCase()),k="empty"==l?"":"all"==l?g:x[b]))),h.success&&h.success(b,c,e,f),j.html(k)},statusCode:A[b]||N.Configs.urlErrors,error:function(){h.error&&h.error(b,c,e,f)},complete:function(){h.end&&h.end(b,c,e,f)}})},h=function(b){var c=b.data,d=a(this).attr(c.hash),e=a(this).attr(c.url);d||a(this).attr("href")&&(d=a(this).attr("href")),e||a(this).attr("href")&&(e=a(this).attr("href")),d&&(B[d]&&(e=B[d][0]),n(d,e,c),g(d,e,c,null),c.prevent&&b.preventDefault())},i=function(b){a(b.actions).off("click",h),a(b.actions).on("click",b,h)},j=function(b,c,d){var f,g,h,i,j,e=c.exec(d);if(e){for(f=C[b][0],g=e.slice(1),a.each(g,function(a,b){g[a]=decodeURIComponent(b)}),h=new Array,b.replace(H,function(a){h.push(a.substring(1))}),i={},j=0;j<g.length;j++)i[h[j]]=g[j];return f=f.replace(J,function(a,b){return i[b]?i[b]:(b=b.replace(K,""),L.test(b)?g[parseInt(b)]:"")})}return d},k=function(){C&&a.each(C,function(b,c){var g,d=M(b),e=c[1],f={};a.extend(!0,f,N.Configs,e),g=o(f),a(f.actions).each(function(){var h,i;c[0],h=a(this).attr(f.hash),d.test(h)&&(A[h]=g.urlError,y[h]=g.loading,i=B[h][0],B[h][0]=j(b,d,i),B[h][1]=f)})})},l=function(b,c,d){N.cookieLast&&a.cookie&&window.JSON&&JSON.parse&&(a.cookie("hash",b),a.cookie("url",c),a.cookie("opoa",JSON.stringify(d)))},m=function(a,b,c){var d,e;window.history.pushState&&(d=f+a,e={hash:a,url:b,opoa:c},window.history.replaceState(e,document.title,d)),l(a,b,c)},n=function(a,b,c){var d,e;window.history.pushState?(d=f+a,e={hash:a,url:b,opoa:c},window.history.pushState(e,document.title,d)):window.location.hash="#"+a,l(a,b,c)},o=function(a){var c,b=a["urlErrors"];return delete a["urlErrors"],c=a["loading"],delete a["loading"],{urlErrors:b,loading:c}},p=function(b){a.each(C,function(c,d){var g,h,i,e=M(c),f=d[1];return e.test(b)?(g={},a.extend(!0,g,N.Configs,f),h=j(c,e,b),x[b]=g.notFound,i=o(g),A[b]=i.urlError,y[b]=i.loading,B[b]=[h,g],!1):void 0})},q=function(b){var c={};return a(b.actions).each(function(){var e=a(this).attr(b.hash),f=a(this).attr(b.url);f?c[e]=[f,b]:(p(e),c[e]||(f=e,c[e]=[f,b]))}),c},r=function(b,c){var d={};return a(b.actions).each(function(){var f=a(this).attr(b.hash);d[f]=c}),d},s=function(b,c){var d={};return a(b.actions).each(function(){var f=a(this).attr(b.hash);d[f]=c}),d},t=function(b){a(b.actions).each(function(){var d=a(this).attr(b.hash);x[d]=b.notFound}),delete b.notFound},u=function(b,c){var d,e;p(b),B[b]?(d=B[b][0],e={},8!=z(B[b][1])?(a.extend(!0,e,N.Configs,B[b][1]),o(e),B[b][1]=e):e=B[b][1],m(b,d,e),g(b,d,e,c)):N.notHash(b)},v=function(){var a,b;d.home.hash?d.home.url?g(d.home.hash,d.home.url,d.home.opoa,d.home.postData):(a=d.home.hash,b=d.home.postData,u(a,b)):N.homeFun()},w=function(a){delete a.notFound,delete a.loading,delete a.urlErrors},x={},y={},z=function(b){var c=0;return a.each(b,function(){c++}),c},A={},B={},C={},D=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},E=/\((.*?)\)/g,F=/(\(\?)?:\w+/g,G=/\*\w+/g,H=/(\(\?)?:\w+|\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g,J=/\{([^}]+)\}/g,K=/\ /g,L=/^[0-9]+$/,M=function(a){return a=a.replace(I,"\\$&").replace(E,"(?:$1)?").replace(F,function(a,b){return b?a:"([^/]+)"}).replace(G,"(.*?)"),new RegExp("^"+a+"$")};return a(window).on("popstate",function(){var a,b,c;window.history.state?(a=window.history.state.url,b=window.history.state.hash,c=window.history.state.opoa,g(b,a,c,null)):v()}),N={cookieLast:!0,Configs:{actions:null,show:null,hash:"hash",url:"hash",find:null,notFound:"empty",method:"post",prevent:!0,actionMaps:{},urlErrors:{404:function(){},500:function(){}},loading:{start:function(){},success:function(){},error:function(){},end:function(){}}},notHash:function(){},addActionMap:function(b,c,d){if(D(b))a.each(b,function(b,c){if(D(c)){var d={};a.extend(!0,d,N.Configs,c[2]),x[c[0]]=d.notFound,w(d),-1!=c[0].indexOf(":")||-1!=c[0].indexOf("*")?C[c[0]]=[c[1],d]:B[c[0]]=[c[1],d]}else a.each(c,function(b,c){var d={};d=a.extend(!0,d,N.Configs,c[1]),x[b]=d.notFound,w(d),-1!=b.indexOf(":")||-1!=b.indexOf("*")?C[b]=[c[0],d]:B[b]=[c[0],d]})});else{var e={};a.extend(!0,e,N.Configs,d),x[b]=e.notFound,w(e),-1!=b.indexOf(":")||-1!=b.indexOf("*")?C[b]=[c,e]:B[b]=[c,e]}},addActionUrlErrors:function(b,c){D(b)?a.each(b,function(a,b){A[b]=c}):A[b]=c},addActionLoadings:function(b,c){D(b)?a.each(b,function(a,b){y[b]=c}):y[b]=c},start:function(b,c){c&&(D(c)?N.addActionMap(c):a.each(c,function(a,b){N.addActionMap(a,b[0],b[1])})),a(function(){var c,d,f;b&&(a.each(b,function(b,c){var e,f,g,h,d={};a.extend(!0,d,N.Configs,c),e=o(d),c["actionMaps"]&&a.each(c["actionMaps"],function(a,b){N.addActionMap(a,b,d)}),t(d),f=q(d),B=a.extend(f,B),g=r(d,e.urlErrors),A=a.extend(g,A),h=s(d,e.loading),y=a.extend(!0,h,y),i(d)}),k()),e&&(e=!1,window.location.hash?(c=window.location.hash.substring(1),u(c,null)):N.cookieLast?a.cookie&&window.JSON&&JSON.parse?(c=a.cookie("hash"),d=a.cookie("url"),f=a.cookie("opoa"),f?(f=JSON.parse(f),d&&(m(c,d,f),p(c),g(c,d,f,null))):v()):v():v())})},home:function(a,b){d.home={hash:a,postData:b}},homeUrl:function(b,c,e){var h,f="",g={};a.extend(!0,g,N.Configs,c),x[f]=g.notFound,delete g.notFound,h=o(g),N.addActionLoadings(f,h.loading),d.home={hash:f,url:b,opoa:g,postData:e}},homeFun:function(){},load:function(b,c){a(function(){p(b),B[b]?(n(b,B[b][0],B[b][1]),g(b,B[b][0],B[b][1],c)):notHash&&N.notHash(b)})},noConflict:function(a){return window.OPOA===N&&(window.OPOA=c),a&&window.EasyOPOA===N&&(window.EasyOPOA=b),N}},window.EasyOPOA=window.OPOA=N,N});